<template>
    <input id="modelFileInput" type="file" webkitdirectory directory v-on:change="onFileChange" hidden>
    <button @click="importButtonOnClick" type="button" class="btn btn-light">
        <i class="fa fa-folder"></i>
        Import Model
    </button>
</template>

<script>
import * as tf from '@tensorflow/tfjs';

export default {
    name: "ImportModel",
    methods: {
        importButtonOnClick: function() {
            document.getElementById("modelFileInput").click()
        },
        onFileChange: function(e) {
            const fileList = e.target.files;
            for (let i = 0, numFiles = fileList.length; i < numFiles; i++) {
                const file = fileList[i];
                if(file.name[0] != '.' && (file.type.includes("json") && file.name.includes("model"))) {
                    this.importModel(file);
                    break;
                }
            }
        },
        importModel: async function(modelFile) {
            tf.serialization.registerClass(L2);
            await tf.loadLayersModel(modelFile.webkitRelativePath).then((model) => this.modelLoaded(model));
        },
        modelLoaded: function(model) {
            const instance = [[[-3.3523560e-02,  9.8258060e+00, -3.1604004e-01, -4.2724610e-04, 2.6702880e-03, -4.4250488e-04],
                                [-4.7882080e-02,  9.8162230e+00, -1.3407898e-01,  1.6937256e-03, -5.1879880e-04,  6.2561035e-04],
                                [-4.3090820e-02,  9.8210140e+00, -1.9154358e-01, -1.4953613e-03, -1.5869141e-03, -4.4250488e-04],
                                [-3.8314820e-02,  9.8162230e+00, -8.6196900e-02, -1.4953613e-03, -1.5869141e-03, -1.5106201e-03],
                                [-3.8314820e-02,  9.8210140e+00, -1.5322876e-01, -1.4953613e-03, -5.1879880e-04, -4.4250488e-04],
                                [-3.3523560e-02,  9.8162230e+00, -4.3090820e-02, -4.2724610e-04, -1.5869141e-03,  6.2561035e-04],
                                [-3.8314820e-02,  9.8210140e+00, -3.3523560e-02, -2.5634766e-03,  1.6174316e-03, -4.4250488e-04],
                                [-3.3523560e-02,  9.8210140e+00, -4.7912598e-03,  6.4086914e-04, -5.1879880e-04, -4.4250488e-04],
                                [-2.8732300e-02,  9.8258060e+00, -6.2255860e-02, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.3523560e-02,  9.8258060e+00, -5.7464600e-02,  6.4086914e-04, 5.4931640e-04,  6.2561035e-04],
                                [-3.8314820e-02,  9.8210140e+00, -7.6614380e-02, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.3523560e-02,  9.8258060e+00, -1.0534668e-01,  6.4086914e-04, -1.5869141e-03,  6.2561035e-04],
                                [-3.8314820e-02,  9.8210140e+00, -1.3887024e-01, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.8314820e-02,  9.8210140e+00, -1.1492920e-01, -4.2724610e-04, 5.4931640e-04,  6.2561035e-04],
                                [-3.8314820e-02,  9.8210140e+00, -1.6758728e-01, -4.2724610e-04, -5.1879880e-04,  6.2561035e-04],
                                [-4.3090820e-02,  9.8210140e+00, -1.2449646e-01,  6.4086914e-04, -5.1879880e-04, -4.4250488e-04],
                                [-4.7882080e-02,  9.8258060e+00, -1.3887024e-01, -1.4953613e-03, -1.5869141e-03, -4.4250488e-04],
                                [-3.3523560e-02,  9.8258060e+00, -1.1013794e-01, -1.4953613e-03, -1.5869141e-03,  6.2561035e-04],
                                [-4.3090820e-02,  9.8210140e+00, -6.7031860e-02, -1.4953613e-03, -5.1879880e-04,  6.2561035e-04],
                                [-4.3090820e-02,  9.8210140e+00, -8.1405640e-02,  6.4086914e-04, -5.1879880e-04, -1.5106201e-03],
                                [-2.8732300e-02,  9.8258060e+00, -8.1405640e-02, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-4.3090820e-02,  9.8210140e+00, -9.0972900e-02,  6.4086914e-04, 5.4931640e-04,  6.2561035e-04],
                                [-3.3523560e-02,  9.8210140e+00, -8.1405640e-02,  6.4086914e-04, -5.1879880e-04,  6.2561035e-04],
                                [-3.3523560e-02,  9.8305970e+00, -1.1492920e-01, -4.2724610e-04, -5.1879880e-04, -4.4250488e-04],
                                [-2.8732300e-02,  9.8162230e+00, -1.1492920e-01, -4.2724610e-04, 5.4931640e-04,  6.2561035e-04],
                                [-3.8314820e-02,  9.8258060e+00, -1.2449646e-01,  6.4086914e-04, 5.4931640e-04,  6.2561035e-04],
                                [-3.3523560e-02,  9.8162230e+00, -1.0534668e-01, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.3523560e-02,  9.8210140e+00, -1.0055542e-01,  6.4086914e-04, -5.1879880e-04, -4.4250488e-04],
                                [-2.8732300e-02,  9.8162230e+00, -1.0055542e-01,  6.4086914e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.3523560e-02,  9.8114320e+00, -1.1013794e-01, -4.2724610e-04, 5.4931640e-04, -4.4250488e-04],
                                [-3.8314820e-02,  9.8210140e+00, -1.0534668e-01,  1.6937256e-03, -5.1879880e-04,  6.2561035e-04],
                                [-3.3523560e-02,  9.8258060e+00, -1.1492920e-01, -4.2724610e-04, -5.1879880e-04,  6.2561035e-04]]]
                                
            const data = this.$store.state.data[0]?.dataPoint[3];
            if(data != null){
                console.log(data.id);
                console.log(data);
            }
            else{
                const tensor = tf.tensor(instance);
                let a = model.predict(tensor);
                a.print();
            }
        },
    }
}

class L2 {

    static className = 'L2';

    constructor(config) {
        return tf.regularizers.l1l2(config)
    }
}
</script>

<style scoped>
li {
    margin: 5px;
}

button {
    background-color: #e1e1e5;
    font-size: 1vw;
}   
</style>